language: java
jdk:
- openjdk8
addons:
  firefox: 55.0.3

env:
  global:
    secure: AAAAB3NzaC1yc2EAAAADAQABAAABAQDDa+m4VPMl7fFK3EvxGGSwRRahB3z5uwuyktjqd92kbbmxyr68ouJM6D2EW60G/ZbJOCE2Io52IlgGntmly0u5FV8StpTDOMiuIHWKXfdJrhCkiH6+UqhPSWnM88Oa+8ce723BN9phVDCKHTqb673iOWwiu5KT1sxEC5ZCId4ckVv8JRkP2QRcNvvHDErn8b6K0GMDBICPoDPm0H8VsCWg7O6joSyAFinA9DnEXieAHOINELx6yEP6ve0AtGx3pzSfeFNvMo7VYiZD9WtPuEjjNiShyCpPgcvcHSagEiVnMmLmb9ZmyryTr8jFgcGS/KnNNrNwuCrqed6gOeoExY1n 

before_install:
    - sudo pip install -r robot/requirements.txt
    - chmod +x gradlew
install:
    - "./gradlew bootRepackage"
before_script:
    - export DISPLAY=:99.0
    - sh -e /etc/init.d/xvfb start
    - sleep 3
    - wget https://github.com/mozilla/geckodriver/releases/download/v0.18.0/geckodriver-v0.18.0-linux64.tar.gz
    - mkdir geckodriver
    - tar zxvf geckodriver-v0.18.0-linux64.tar.gz -C geckodriver
    - export PATH=$PATH:$PWD/geckodriver
script:
    - java -jar build/libs/orders-0.0.1-SNAPSHOT.jar &> /dev/null &
    - sleep 20
before_deploy:
    - openssl aes-256-cbc -K $encrypted_0f26728d1c46_key -iv $encrypted_0f26728d1c46_iv
     -in sshkey.enc -out orders -d
    - chmod 600 orders
deploy:
    - provider: script
      skip_cleanup: true
      script: scp -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -i orders build/libs/orders-0.0.1-SNAPSHOT.jar ubuntu@orders.arcada.nitor.zone:app.jar
      on:
        branch: master
    - provider: script
      skip_cleanup: true
      script: ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -tt -i orders ubuntu@orders.arcada.nitor.zone /home/ubuntu/restartApp.sh
      on:
        branch: master
